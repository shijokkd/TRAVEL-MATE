"use strict";(this.webpackChunk_hz_project_x=this.webpackChunk_hz_project_x||[]).push([[35615],{927006:(t,i,e)=>{e.d(i,{q:()=>r});const r={brickActivatePerf:new(e(772937).L0)("brick-activate-perf",!1)}},459708:(t,i,e)=>{e.d(i,{w:()=>r});class r{constructor(t){this.locator=t}async activateOnDemandBrick(t){return Promise.reject(new Error("On-demand brick activation not supported."))}}},615955:(t,i,e)=>{e.d(i,{S:()=>r});class r{constructor(t,i,e){this._appConfig=t,this._getDependencies=i,this._brickValidator=e}shouldInertBrick(t,i){return!(!t.requiredFlags||t.requiredFlags.every((t=>i[t])))||!(!t.requiredDraftModels||t.requiredDraftModels.every((t=>i[t])))}async collectBricksAndDependencies(t){const i=new Set,e=await this._appConfig.getFeatures(!0);for(const r of t)this._collectBrickAndDependencies(r,e,i);return[...i]}_collectBrickAndDependencies(t,i,e=new Set,r=[]){if(-1!==r.indexOf(t))throw new Error(`Circular brick dependency detected for brick "${t.id}" - ancestors: [${r.join(", ")}]`);if(e.has(t))return;if(this.shouldInertBrick(t,i))return;e.add(t),r.push(t);const a=void 0!==this._brickValidator;if(a&&!this._brickValidator.isValidLevel(t.level))throw new Error(`Invalid brick level for ${t.id}`);const n=this._getDependencies(t);for(const s of n){if(a&&!this._brickValidator.isValidLevelDependency(t.level,s.level))throw new Error(`Invalid brick level dependency from ${t.id} (${t.level}) to ${s.id} (${s.level})`);this._collectBrickAndDependencies(s,i,e,r)}r.pop()}}},678898:(t,i,e)=>{e.d(i,{i:()=>m});var r=e(843074),a=e(197275),n=e(273488),s=e(459708),o=e(927006),c=e(615955),h=e(805459),d=e(47346),l=e(292243);class m{constructor(t,i,e){this._appConfig=t,this._perf=i,this._activeBrickEntries=new Map,this._isBrickActivatePerfEnabledDeferred=new r.B;const a=(0,d.Z)();this._perf.beginAction(h.l.brickManagerConstruction,h.l.brickManagerConstruction,a,void 0,{marked:!0}),this._isBrickActivatePerfEnabledDeferred.adopt(this._appConfig.attach(o.q).then((()=>o.q.brickActivatePerf.enabled)));this._brickDependencyCollector=new c.S(this._appConfig,(t=>t.dependencies??[]),e),this._perf.endAction(a)}isBrickActive(t){return this._activeBrickEntries.has(t)}async activateBrick(t,i){return await this.activateBricks(t,[i]),this._activeBrickEntries.get(i.id)?.brick}async _activateBrickWithoutDependencies(t,i,e){const r=i.id;if(this._validateActivatingBrickId(i),(i.requiredFlags||i.requiredDraftModels)&&this._brickDependencyCollector.shouldInertBrick(i,e))return;if(this._activeBrickEntries.has(r))return;const a=this._createBrickInstance(i);return this._activateBrickInstance(t,a,r)}async activateBrickInstance(t,i,e){if(!this._activeBrickEntries.has(e))return this._activateBrickInstance(t,i,e)}async _activateBrickInstance(t,i,e){const r=this._createBrickContext(t),a=this._createBrickDeactivator(e),n=i.constructor;return await this._activateBrick(e,{brickConstructor:n,brick:i,context:r},a),i}async collectBricksAndDependencies(t){return this._brickDependencyCollector.collectBricksAndDependencies(t)}async activateBricks(t,i){const e=await this.collectBricksAndDependencies(i);return this._activateBricks(t,e)}async activateBricksUsingPrecomputedDependencies(t,i){return this._activateBricks(t,i)}async _activateBricks(t,i){const e=await this._appConfig.getFeatures(!0);return await Promise.all(i.map((i=>this._activateBrickWithoutDependencies(t,i,e))))}_validateActivatingBrickId(t){const i=t.id;if(!i)throw new Error("Missing brick id property");if(this._activeBrickEntries.has(i)){if(this._activeBrickEntries.get(i).brickConstructor!==t)throw new Error(`Brick with ID "${i}" was already activated with a different constructor`)}if("function"!=typeof t)throw new Error(`Brick with ID "${i}" is not a constructor`);if(t.prototype.requiredFlags||t.prototype.requiredDraftModels)throw new Error(`Brick with ID "${i}" must specify requiredFlags and/or requiredDraftModels as static fields, not instance members`)}_createBrickInstance(t){let i;try{i=new t}catch(i){throw new Error(`TypeError: Brick with ID "${t.id}" threw an exception`)}if("function"!=typeof i.onActivate)throw new Error(`Brick with ID "${t.id}" is missing the activate lifecycle method`);return i}async _activateBrick(t,i,e){this._activeBrickEntries.set(t,i);try{const r=await this._isBrickActivatePerfEnabledDeferred.promise;r&&this._perf.beginStartupAction(`brick-activate-${t}`);const{brick:a,context:n}=i;await a.onActivate(n,e),r&&this._perf.endStartupAction(`brick-activate-${t}`)}catch(i){let e;throw this._activeBrickEntries.delete(t),e=i instanceof a.R?i:new a.R("BrickActivation",`Failed to activate brick with ID "${t}"`,i),this._handleBrickActivationError(e),e}}_handleBrickActivationError(t){l.I.logClientFatalError(t,n.Yd.singleton())}setBrickContextFactory(t){this._brickContextFactory=t}_createBrickContext(t){return void 0===this._brickContextFactory?new s.w(t):this._brickContextFactory(t)}_createBrickDeactivator(t){return async()=>this._deactivateBrick(t)}async _deactivateBrick(t){const i=this._activeBrickEntries.get(t);if(!i)throw new a.R("BrickDeactivation",`Brick "${t}" is not active.`);const{brick:e,context:r}=i;await(e.onDeactivate?.(r)),this._activeBrickEntries.delete(t)}async deactivateBricks(){for(const t of[...this._activeBrickEntries.keys()].reverse())await this._deactivateBrick(t)}async loadDynamicBricks(t,i){i&&await Promise.all(i.map((async i=>{const e=await import(i);return this.activateBrick(t,e.default)})))}get activeBrickIds(){return Array.from(this._activeBrickEntries.keys()).sort()}}},292243:(t,i,e)=>{e.d(i,{I:()=>a});var r=e(197275);class a{static _isChunkLoadError(t){return t instanceof r.R&&void 0!==t.previousError?a._isChunkLoadError(t.previousError):"ChunkLoadError"===t.name}static logClientFatalError(t,i){if(a._isChunkLoadError(t)||!(t instanceof r.R))return;const e={error:t,"custom.brickFatalError":!0};i.error(t.message,e)}}},805459:(t,i,e)=>{var r;e.d(i,{l:()=>r}),function(t){t.brickManagerConstruction="brick-manager-construction"}(r||(r={}))},871669:(t,i,e)=>{e.d(i,{Q:()=>o});class r{constructor(t){this._trailingFramesCapacity=t,this._trailingFrames=[],this._trailingFramesAvgDuration=0,this._trailingFramesMinDuration=1/0,this._trailingFramesMaxDuration=-1/0,this._needsRecomputeTrailingFramesMinMaxDuration=!0,this._allFramesCount=0,this._allFramesAvgDuration=0,this._allFramesMinDuration=1/0,this._allFramesMaxDuration=-1/0}push(t){if(t.hasEnded)if(this._trailingFrames.push(t),this._allFramesCount++,this._allFramesMinDuration=Math.min(t.duration,this._allFramesMinDuration),this._allFramesMaxDuration=Math.max(this._allFramesMaxDuration,t.duration),this._allFramesAvgDuration=this._allFramesAvgDuration+(t.duration-this._allFramesAvgDuration)/this._allFramesCount,this._trailingFrames.length<=this._trailingFramesCapacity)this._trailingFramesAvgDuration=this._allFramesAvgDuration,this._trailingFramesMinDuration=this._allFramesMinDuration,this._trailingFramesMaxDuration=this._allFramesMaxDuration,this._needsRecomputeTrailingFramesMinMaxDuration=!1;else{const i=this._trailingFrames.shift();this._trailingFramesAvgDuration=this._trailingFramesAvgDuration+(t.duration-i.duration)/this._trailingFramesCapacity,this._needsRecomputeTrailingFramesMinMaxDuration=!0}else console.warn("Complete frame required.")}get trailingFramesCapacity(){return this._trailingFramesCapacity}get trailingFramesCount(){return this._trailingFrames.length}get trailingFrames(){return this._trailingFrames}get trailingAvgDuration(){return this._trailingFramesAvgDuration}get trailingMinDuration(){return this._recomputeTrailingFramesMinMaxDurationIfNeeded(),this._trailingFramesMinDuration}get trailingMaxDuration(){return this._recomputeTrailingFramesMinMaxDurationIfNeeded(),this._trailingFramesMaxDuration}_recomputeTrailingFramesMinMaxDurationIfNeeded(){if(!1!==this._needsRecomputeTrailingFramesMinMaxDuration){this._trailingFramesMinDuration=1/0,this._trailingFramesMaxDuration=-1/0;for(const t of this._trailingFrames){const i=t.duration;i<this._trailingFramesMinDuration&&(this._trailingFramesMinDuration=i),this._trailingFramesMaxDuration<i&&(this._trailingFramesMaxDuration=i)}Number.isFinite(this._trailingFramesMinDuration)||(this._trailingFramesMinDuration=0),Number.isFinite(this._trailingFramesMaxDuration)||(this._trailingFramesMaxDuration=0),this._needsRecomputeTrailingFramesMinMaxDuration=!1}}get framesCount(){return this._allFramesCount}get avgDuration(){return this._allFramesAvgDuration}get minDuration(){return Number.isFinite(this._allFramesMinDuration)?this._allFramesMinDuration:0}get maxDuration(){return Number.isFinite(this._allFramesMaxDuration)?this._trailingFramesMaxDuration:0}}class a{constructor(t,i,e,r,a,n,s,o,c,h){this._category=t,this._name=i,this._id=e,this._startTime=r,this._startTimeOffset=a,this._recordsFrames=n,this._locked=s,this._marked=o,this._frameCapacity=c,this._hasBeenHidden=h,this._endTime=-1,this._framesByName=new Map,this._metadata=void 0,this._endTimeOffset=0}static createForTrailingFrames(t){return new a("","","",-1,0,!0,!1,!1,t,!1)}get hasEnded(){return this._endTime>0}get hasBeenHidden(){return this._hasBeenHidden}set hasBeenHidden(t){this._hasBeenHidden=t}get category(){return this._category}get name(){return this._name}get id(){return this._id}get startTime(){return this._startTime}get endTime(){return this._endTime}get startTimeOffset(){return this._startTimeOffset}get endTimeOffset(){return this._endTimeOffset}set endTimeOffset(t){this._endTimeOffset=t}get recordsFrames(){return this._recordsFrames}get locked(){return this._locked}get marked(){return this._marked}get frameCapacity(){return this._frameCapacity}get duration(){return this.hasEnded?this._endTime-this._startTime:-1}get metadata(){return this._metadata}set metadata(t){this._metadata=t}getFramesByName(t){return this._framesByName.get(t)}getNumFramesByName(t){return this.getFramesByName(t)?.framesCount??0}end(t){t<this._startTime?(console.warn(`PerfAction.end: endTime should be greater than or equal to startTime for action with name "${this.name}" and id "${this.id}".`),this._endTime=this._startTime):this._endTime=t}isFrameInRange(t){return t.startTime>=this._startTime&&(-1===this._endTime||t.endTime<=this._endTime)}pushFrame(t,i){if(!this._recordsFrames)return;let e=this.getFramesByName(t);e||(e=new r(this._frameCapacity),this._framesByName.set(t,e)),e.push(i)}}class n{constructor(t){this._startTime=t,this._endTime=-1}end(t){t<this._startTime?(console.warn("PerfFrame.end: endTime should be greater than or equal to startTime."),this._endTime=this._startTime):this._endTime=t}get hasEnded(){return this._endTime>0}get startTime(){return this._startTime}get endTime(){return this._endTime}get duration(){return this.hasEnded?this._endTime-this._startTime:-1}}var s=e(267975);class o extends s.a{constructor(t){super(t.currentTimeFn,t.timeOrigin,t.currentDateFn),this._completedActions=[],this._openActionsByID=new Map,this._firstTimeOriginActionsById=new Map,this._openFramesByName=new Map,this._hasVisibilityEverBeenHidden="hidden"===document.visibilityState,this._globalActionMetadata={},this._isMonitoringActions=!1,this._onVisibilityChange=()=>{if("hidden"===document.visibilityState){this._hasVisibilityEverBeenHidden=!0;[...this._openActionsByID.values()].forEach((t=>{t.hasBeenHidden=!0}))}},this._maxActions=t.maxActions,this._trailingFramesAction=a.createForTrailingFrames(t.numTrailingFramesToTrack),this._markAllActions=t.markAllActions}get trailingFramesAction(){return this._trailingFramesAction}get completedActions(){return this._completedActions}startMonitoringActions(t){this._isMonitoringActions||(this._isMonitoringActions=!0,this._actionCompleteCallback=t,this.startVisibilityEventListener(),this._completedActions.forEach((i=>t(i))))}stopMonitoringActions(){this._isMonitoringActions&&(this.stopVisibilityEventListener(),this._actionCompleteCallback=void 0,this._isMonitoringActions=!1)}_onActionCompleted(t){let i=!0;this._completedActions.length>=this._maxActions&&(this._removeOldestAction()||(i=!1)),i&&this._completedActions.push(t),this._isMonitoringActions&&void 0!==this._actionCompleteCallback&&this._actionCompleteCallback(t)}registerCompletedAction(t,i,e,r,a,n){const s=a??this.currentTime();super.registerCompletedAction(t,i,e,r,s,n)}startVisibilityEventListener(){document.addEventListener("visibilitychange",this._onVisibilityChange)}stopVisibilityEventListener(){document.removeEventListener("visibilitychange",this._onVisibilityChange)}_beginAction(t,i,e,r,n){if(this._openActionsByID.has(e))return;if("startup"===t&&n.firstTimeOnly&&this._firstTimeOriginActionsById.has(e))return;const s=!!n.originAction&&this._hasVisibilityEverBeenHidden,c=new a(t,i,e,r,n.startTimeOffset??0,n.recordsFrames,n.locked,n.marked,o.DEFAULT_MAX_FRAMES_PER_ACTION,s);this._openActionsByID.set(e,c),"startup"===t&&n.firstTimeOnly&&this._firstTimeOriginActionsById.set(e,c);(this._markAllActions||n.marked)&&this._beginMark(c,n.markStartTime)}_endAction(t,i){const e=this._openActionsByID.get(t);if(!e){if(i.noError)return;return void console.error(`Action not found with id: ${t}`)}const r=this._markAllActions||e.marked;if(e.end(i.endTime),e.endTimeOffset=i.endTimeOffset??0,r&&this._endMark(e),Object.keys(this._globalActionMetadata).length>0){const t=Object.assign({},this._globalActionMetadata,e.metadata);e.metadata=t}this._openActionsByID.delete(e.id),this._onActionCompleted(e)}_setActionMetadata(t,i){const e=this._openActionsByID.get(t);e?e.metadata=i:console.warn(`Action not found with id: ${t}`)}_addActionMetadata(t,i,e){const r=this._openActionsByID.get(t);if(r)r.metadata={...r.metadata,...i};else{if(e.noError)return;console.warn(`Action not found with id: ${t}`)}}_setGlobalActionMetadataEntry(t,i){Object.keys(this._globalActionMetadata).length>=8?console.warn("Too many global metadata values"):void 0!==i?this._globalActionMetadata[t]=i:delete this._globalActionMetadata[t]}_beginFrame(t,i){if(this._openFramesByName.has(t))return void console.error(`Frame has already begun with name: ${t}`);const e=new n(i);this._openFramesByName.set(t,e)}_endFrame(t,i){const e=this._openFramesByName.get(t);e?(e.end(i),this._openFramesByName.delete(t),this._pushFrameToOpenActions(t,e),this._trailingFramesAction.pushFrame(t,e)):console.error(`Frame not found with name: ${t}`)}_pushFrameToOpenActions(t,i){this._openActionsByID.forEach((e=>{e.isFrameInRange(i)&&e.pushFrame(t,i)}))}_removeOldestAction(){const t=this._completedActions.findIndex((t=>!t.locked));return!(t<0)&&(this._completedActions.splice(t,1),!0)}_beginMark(t,i){const e=void 0!==i?{startTime:i}:{startTime:t.startTime-this.timeOrigin};performance.mark(this._getMarkName(t.category,t.id,"begin"),e)}_endMark(t){const i={startTime:t.endTime-this.timeOrigin};performance.mark(this._getMarkName(t.category,t.id,"end"),i),performance.measure(this._getMarkName(t.category,t.id),this._getMarkName(t.category,t.id,"begin"),this._getMarkName(t.category,t.id,"end"))}_getMarkName(t,i,e){return e?`${t}:${i}:${e}`:`${t}:${i}`}}o.DEFAULT_MAX_FRAMES_PER_ACTION=1800},426095:(t,i,e)=>{e.d(i,{Q:()=>s,Y:()=>a});var r=e(678898);class a{isValidLevelDependency(){return!0}isValidLevel(t){return"foundation"!==t}}async function n(t){const[i,e]=await t.getAll(["AppConfig","PerfMonitorModel"]);return new r.i(i,e,new a)}function s(t){t.set("BrickManager",n)}}}]);
//# sourceMappingURL=35615.cd20d692f1c740d0a044.js.map